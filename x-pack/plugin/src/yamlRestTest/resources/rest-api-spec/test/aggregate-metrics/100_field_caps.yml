setup:
  - skip:
      version: " - 8.3.99"
      reason: aggregate_metric_double field caps changed in 8.4.0

  - do:
      indices.create:
        index:  test_aggregate_metric
        body:
          mappings:
            properties:
              metric:
                type: aggregate_metric_double
                metrics: [min, max, value_count]
                default_metric: max

---
field capabilities:
  - skip:
      version: " - 8.3.99"
      reason: aggregate_metric_double field caps changed in 8.4.0

  - do:
      field_caps:
        index: test_aggregate_metric
        fields: [metric]

  - match: {fields.metric.aggregate_metric_double.searchable:    true}
  - match: {fields.metric.aggregate_metric_double.aggregatable:  true}
  - is_false: fields.metric.aggregate_metric_double.indices


---
field capabilities with conflict:
  - skip:
      version: " - 8.3.99"
      reason: aggregate_metric_double field caps changed in 8.4.0

  - do:
      indices.create:
        index:  test_double
        body:
          mappings:
            properties:
              metric:
                type: double

  - do:
      field_caps:
        index: test_*
        fields: [metric]

  - match: {fields.metric.aggregate_metric_double.searchable:    true}
  - match: {fields.metric.aggregate_metric_double.aggregatable:  true}
  - match: {fields.metric.aggregate_metric_double.indices:  [test_aggregate_metric]}
  - match: {fields.metric.double.searchable:    true}
  - match: {fields.metric.double.aggregatable:  true}
  - match: {fields.metric.double.indices:  [test_double]}
